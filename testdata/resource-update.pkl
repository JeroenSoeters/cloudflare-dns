/*
 * Conformance Test: Update Resource (in-place)
 *
 * This file modifies mutable fields to trigger an in-place update.
 * Changes from resource.pkl:
 *   - content: changed from "192.0.2.1" to "192.0.2.2"
 *   - ttl: changed from 300 to 600
 *   - comment: changed text
 *
 * These fields do NOT have createOnly=true, so formae should update
 * the resource in place without replacement.
 */
amends "@formae/forma.pkl"
import "@formae/formae.pkl"

import "@cloudflare-dns/cloudflare-dns.pkl" as dns

local stackName = "plugin-sdk-test-stack"
local testRunID = read("env:FORMAE_TEST_RUN_ID")
local zoneID = read("env:CLOUDFLARE_ZONE_ID")

forma {
  new formae.Stack {
    label = stackName
    description = "Plugin SDK conformance test stack"
  }

  new formae.Target {
    label = "cloudflare"
    namespace = "CLOUDFLARE"
    config = new Mapping {
      ["zone_id"] = zoneID
    }
  }

  new dns.Record {
    label = "plugin-sdk-test-record"
    zone_id = zoneID
    name = "formae-test-\(testRunID)"          // unchanged (createOnly)
    record_type = "A"                           // unchanged (createOnly)
    content = "192.0.2.2"                       // CHANGED from "192.0.2.1"
    ttl = 600                                   // CHANGED from 300
    proxied = false
    comment = "Updated by conformance test"    // CHANGED
  }
}
