/*
 * Basic Example
 *
 * This example shows how to define DNS records using the Cloudflare DNS plugin.
 * Run with: formae apply --mode reconcile --watch examples/basic/main.pkl
 *
 * Required environment variables:
 * - CLOUDFLARE_API_TOKEN: Your Cloudflare API token
 * - CLOUDFLARE_ZONE_ID: The zone ID for your domain
 */
amends "@formae/forma.pkl"

import "@formae/formae.pkl"
import "@cloudflare-dns/cloudflare-dns.pkl" as dns

local zoneID = read("env:CLOUDFLARE_ZONE_ID")

forma {
  new formae.Stack {
    label = "default"
    description = "Default stack for Cloudflare DNS resources"
  }

  new formae.Target {
    label = "cloudflare"
    namespace = "CLOUDFLARE"
    config = new Mapping {
      ["zone_id"] = zoneID
    }
  }

  // Example A record pointing to an IP address
  new dns.Record {
    label = "my-record"
    zone_id = zoneID
    name = "myapp"
    record_type = "A"
    content = "203.0.113.50"
    ttl = 300
    proxied = true
    comment = "My application server"
  }

  // Example CNAME record
  new dns.Record {
    label = "www-redirect"
    zone_id = zoneID
    name = "www"
    record_type = "CNAME"
    content = "myapp.example.com"
    ttl = 300
    proxied = true
  }

  // Example TXT record for verification
  new dns.Record {
    label = "verification"
    zone_id = zoneID
    name = "_verification"
    record_type = "TXT"
    content = "verification-token-123"
    ttl = 3600
    proxied = false
  }
}
